### T4 

##### 1 emphasis



##### 2 key points

给你一个下标从 **1** 开始、由 `n` 个整数组成的数组。

如果一组数字中每对元素的乘积都是一个完全平方数，则称这组数字是一个 **完全集** 。

下标集 `{1, 2, ..., n}` 的子集可以表示为 `{i1, i2, ..., ik}`，我们定义对应该子集的 **元素和** 为 `nums[i1] + nums[i2] + ... + nums[ik]` 。

返回下标集 `{1, 2, ..., n}` 的 **完全子集** 所能取到的 **最大元素和** 。

完全平方数是指可以表示为一个整数和其自身相乘的数。



##### 3 thought

* 一个完全平方数的质因数分解中，每个质因数的幂次都是偶数

* 如果x和y的乘积是完全平方数，那么x和y质因数分解中，幂次为奇数的质因数是一样的

* 若 要使得一个group中，任意两个元素的乘积是完全平方数，等价于 **这个组中所有数在质因数分解后，所有奇数次幂的质因数的乘积相同**

  ```cpp
  // 比如
  2 = 2 ^ 1;
  8 = 2 ^ 3 = 2 ^ 1;
  18 = (2 ^ 1) * (3 ^ 2) = 2 ^ 1;
  // 那么
  [2,8,18]中任意两个元素相乘可以得到一个完全平方数
  ```

* **质因数分解中 偶数次幂的因子 可以构成一个新的完全平方数，完全平方数A/完全平方数B 还是一个完全平方数**

##### 4 code

```cpp
using ll = long long;
class Solution {
public:
    long long maximumSum(vector<int>& a) {
        int n = a.size();
        a.insert(a.begin(), 0);
        auto deal = [&](int x) {
            ll ans = 1;
            for (int i = 2; i * i <= x; i++) {
                if (x % (i * i) == 0) {
                    while (x % (i * i) == 0) {
                        x /= (i * i);
                    }
                }
                if (x % i == 0) {
                    ans *= i;
                    x /= i;
                }
            }
            if (x) {
                ans *= x;
            }
            return ans;
        };
        
        
        ll ans = 0;
        unordered_map<ll, ll> cnt;
        for (int i = 1; i <= n; i++) {
            ll rs = deal(i);
            cnt[rs] += a[i];
        }
        
        for (auto& [k, v] : cnt) {
            ans = max(ans, v);
        }
        
        return ans;
    }
};
```



##### 5 summary

###### 5.1 完全平方数

* **定理：两个数的乘积是完全平方数，意味着 这两个数除去各自的平方因子，剩下的数是相同的**，因为只有相同，相乘之后才会是一个完全平方数，注意：各自除去的平方因子相乘一定是完全平方数
* **定理：一个完全平方数的质因数分解中，每个质因数的幂次都是偶数**  