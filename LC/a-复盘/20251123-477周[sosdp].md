### T4 [Q4. 有效子序列的数量](https://leetcode.cn/contest/weekly-contest-477/problems/number-of-effective-subsequences/)

##### 1 emphasis

- sosdp
- 容斥原理



##### 2 key points



##### 4 code

```cpp
class Solution {
public:
    using ll = long long;
    const int mod = 1e9 + 7;
    int countEffective(vector<int>& a) {
        int n = a.size();
        int mx = *max_element(a.begin(), a.end());
        int m = 32 - __builtin_clz(mx);

        // 1. 要使得最终的 OR 变小，即 使得某些位上的1变成0
        // 2. 考虑使得哪些位置上的1变成0，枚举需要变0的位置即可:
        //    - 单个位: 要使得b_i位上的1变成0，那么，所有第b_i位上是1的数都需要删除
        //    - 多个位: 同理，设当前枚举的状态是mask，那么所有以mask为子集的数都需要删除
        //    - 假设最终删除的位是 1011，则第0、1、3位上为1的数都要删除
        // 3. 所以对于二进制mask，需要统计其所有子集的和，即sosdp
        // 4. 而对于 mask1 和mask2，mask2是mask1的子集，即 mask1 & mask2 = mask2，会统计重复，故需要使用容斥原理去重
        
        // 举例：元素以二进制列出
        // a = [1100, 1100, 0011, 0011, 0010, 0010, 0001, 0001]
        // - mask = 1时: ans += power(2, 4); [1100, 1100, 0010, 0010] 的子序列
        // - mask = 2时: ans += power(2, 4); [1100, 1100, 0001, 0001] 的子序列
        // - mask = 3时: ans -= power(2, 2); [1100, 1100]的子序列是重复的
        // - ...
      
        // sosdp
        int F = 0;
        vector<int> f(1 << m); for (auto x : a) f[x]++, F |= x;
        for (int d = 0; d < m; d++) {
            for (int mask = 0; mask < (1 << m); mask++) {
                if (mask >> d & 1) {
                    f[mask] += f[mask ^ (1 << d)];
                }
            }
        }
      
      	
        ll P[n + 1]; memset(P, 0, sizeof(P)); P[0] = 1;
        for (int i = 1; i <= n; i++) {
            P[i] = P[i - 1] * 2 % mod;
        }

        ll ans = 0;
        for (int mask = 1; mask < (1 << m); mask++) if ((F & mask) == mask) {
            int c = __builtin_popcount(mask);
            int mask2 = F & (~mask);
            ll t = P[f[mask2]];
            if (c & 1) {
                ans += t;
                ans %= mod;
            } else {
                ans += (-t + mod);
                ans %= mod;
            }
        }
        return ans;
    }
};
```



##### 5 summary

