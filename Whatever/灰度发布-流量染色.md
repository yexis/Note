## 灰度发布             **A/B Testing**                              

<u>灰度从字面意思理解就是存在于黑与白之间的一个平滑过渡的区域</u>





**定义：**

又名金丝雀发布，是指在黑与白之间能够平滑过度的一种发布方式



对于互联网产品来说，上线和未上线就是黑与白之分，而实现未上线功能平稳过渡的一种方式就叫做灰度发布



**灰度期：**

灰度发布开始到结束器件的这一段时间，称为灰度期



> 理解：主要按照一定策略选取一定的用户，让他们先体验新版本的应用，通过收集这部分用户对新版本的反馈（如：微博、微信公众号留言或者产品数据指标统计、用户行为的数据埋点）以及对新版本的功能、性能、稳定等指标进行评论，进而决定继续放大新版本投放范围直至全量升级或回滚至老版本



互联网产品的几个特点：用户规模大、版本更新频繁。新版本的每次上线，产品都要承受极大的压力，而灰度发布很好的规避了这种风险。



`用户区分、流量筛选、实时数据监控、一键发布/回滚、`



**范围控制：**

内部用户-种子用户-活跃用户-所有用户



**优点：**

灰度发布能避免新版本全量上线的风险、通过小流量验证的方式，在灰度阶段就能发现、调整、并优化产品的问题，平滑迭代



**灰度发布流程：**

![img](http://image.woshipm.com/wp-files/2017/12/OsY2ViUlPpm63grWRKyX.png)



`灰度发布一般用于用户量级比较大的产品`



## 流量染色

![image-20200820093450464](/home/yex/.config/Typora/typora-user-images/image-20200820093450464.png)

核心：

- gateway对请求进行染色

染色规则可以是host、header字段、agent终端信息、用户筛选、流量比例等

- 染色信息在服务间传递

go-micro中的http请求以及rpc请求的metadata

- 服务调用时根据染色信息对服务进行筛选，实现调用链路的管控





